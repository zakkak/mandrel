name: Mandrel-Quarkus tests

on:
  push:
    paths-ignore:
      - '.github/workflows/main.yml'
      - '.github/workflows/quarkus.yml'
      - '**.md'
  pull_request:
    paths-ignore:
      - '.github/workflows/main.yml'
      - '.github/workflows/quarkus.yml'
      - '**.md'
  workflow_dispatch: []

# The following aims to reduce CI CPU cycles by:
# 1. Cancelling any previous builds of this PR when pushing new changes to it
# 2. Cancelling any previous builds of a branch when pushing new changes to it in a fork
# 3. Cancelling any pending builds, but not active ones, when pushing to a branch in the main
#    repository. This prevents us from constantly cancelling CI runs, while being able to skip
#    intermediate builds. E.g., if we perform two pushes the first one will start a CI job and
#    the second one will add another one to the queue; if we perform a third push while the
#    first CI job is still running the previously queued CI job (for the second push) will be
#    cancelled and a new CI job will be queued for the latest (third) push.
concurrency:
  group: "workflow = ${{ github.workflow }}, ref = ${{ github.event.ref }}, pr = ${{ github.event.pull_request.id }}"
  cancel-in-progress: ${{ github.event_name == 'pull_request' || github.repository != 'graalvm/mandrel' }}

jobs:
  q-2_2-ea:
    name: "Q 2.2 M 21.3 EA"
    uses: graalvm/mandrel/.github/workflows/base.yml@default
    with:
      quarkus-version: "2.2"
      version: "mandrel/21.3"
      mandrel-packaging-version: "21.3"
      jdk: "ea"
  q-2_2-ea-win:
    name: "Q 2.2 M 21.3 windows EA"
    uses: graalvm/mandrel/.github/workflows/base-windows.yml@default
    with:
      quarkus-version: "2.2"
      version: "mandrel/21.3"
      mandrel-packaging-version: "21.3"
      jdk: "ea"
  q-main-ea:
    name: "Q main M 21.3 EA"
    uses: graalvm/mandrel/.github/workflows/base.yml@default
    with:
      quarkus-version: "main"
      version: "mandrel/21.3"
      mandrel-packaging-version: "21.3"
      jdk: "ea"
  q-main-ea-win:
    name: "Q main M 21.3 windows EA"
    uses: graalvm/mandrel/.github/workflows/base-windows.yml@default
    with:
      quarkus-version: "main"
      version: "mandrel/21.3"
      mandrel-packaging-version: "21.3"
      jdk: "ea"
  q-latest-ea:
    name: "Q latest M 21.3 EA"
    uses: graalvm/mandrel/.github/workflows/base.yml@default
    with:
      quarkus-version: "latest"
      version: "mandrel/21.3"
      mandrel-packaging-version: "21.3"
      jdk: "ea"
  q-latest-ea-win:
    name: "Q latest M 21.3 windows EA"
    uses: graalvm/mandrel/.github/workflows/base-windows.yml@default
    with:
      quarkus-version: "latest"
      version: "mandrel/21.3"
      mandrel-packaging-version: "21.3"
      jdk: "ea"
  # q-2_2-ga:
  #   name: "Q 2.2 M 21.3"
  #   uses: graalvm/mandrel/.github/workflows/base.yml@default
  #   with:
  #     quarkus-version: "2.2"
  #     version: "mandrel/21.3"
  #     mandrel-packaging-version: "21.3"
  #     jdk: "ga"
  # q-2_2-ga-win:
  #   name: "Q 2.2 M 21.3 windows"
  #   uses: graalvm/mandrel/.github/workflows/base-windows.yml@default
  #   with:
  #     quarkus-version: "2.2"
  #     version: "mandrel/21.3"
  #     mandrel-packaging-version: "21.3"
  #     jdk: "ga"
  # q-main-ga:
  #   name: "Q main M 21.3"
  #   uses: graalvm/mandrel/.github/workflows/base.yml@default
  #   with:
  #     quarkus-version: "main"
  #     version: "mandrel/21.3"
  #     mandrel-packaging-version: "21.3"
  #     jdk: "ga"
  # q-main-ga-win:
  #   name: "Q main M 21.3 windows"
  #   uses: graalvm/mandrel/.github/workflows/base-windows.yml@default
  #   with:
  #     quarkus-version: "main"
  #     version: "mandrel/21.3"
  #     mandrel-packaging-version: "21.3"
  #     jdk: "ga"
  # q-latest-ga:
  #   name: "Q latest M 21.3"
  #   uses: graalvm/mandrel/.github/workflows/base.yml@default
  #   with:
  #     quarkus-version: "latest"
  #     version: "mandrel/21.3"
  #     mandrel-packaging-version: "21.3"
  #     jdk: "ga"
  # q-latest-ga-win:
  #   name: "Q latest M 21.3 windows"
  #   uses: graalvm/mandrel/.github/workflows/base-windows.yml@default
  #   with:
  #     quarkus-version: "latest"
  #     version: "mandrel/21.3"
  #     mandrel-packaging-version: "21.3"
  #     jdk: "ga"
